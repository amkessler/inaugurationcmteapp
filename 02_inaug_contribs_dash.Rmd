---
title: "Trump Inauguration Contributions"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    theme: cerulean

---

```{r setup, include=FALSE}

library(flexdashboard)
library(tidyverse)
library(lubridate)
library(janitor)
library(glue)
library(plotly)
library(DT)
# library(googlesheets)
library(kableExtra)
library(RColorBrewer)
# library(htmlwidgets)
library(htmltools)
library(scales)
# library(leaflet)
# library(tigris)
# options(tigris_class = "sf")

options(scipen = 999)


#load data from rds file created in step 01
contribs <- readRDS("contribs_saved.rds")


```





Donors to 2017 Inauguration 
=====================================
To filter, click on the boxes at the top of the columns. To sort, use the up/down arrows by the column names. (Click [here](https://www.dropbox.com/s/249a7wvb4goj0rn/fec_doc_trump_inaug_1.pdf?dl=1) for original FEC pdf document.) 

Row 
-----------------------------------------------------------------------

```{r}

contribs_inaug_only <- contribs %>% 
  select(
    individual_or_organization,
    contributor_name,
    org_name,
    parent_company,
    city,
    state,
    total_amount = inaug_2017_total
  ) %>% 
  mutate(
    individual_or_organization = as.factor(str_to_upper(individual_or_organization)),
    org_name = str_to_upper(org_name),
    parent_company = str_to_upper(parent_company)
  ) %>% 
  arrange(individual_or_organization, desc(total_amount))


datatable(contribs_inaug_only,
          rownames = FALSE,
          filter = "top",
          extensions = 'Buttons', 
          options = list(searchHighlight = TRUE, bPaginate = FALSE, dom = 'Bfrtip',
       buttons = c('copy', 'csv', 'excel', 'print')
          )) %>% 
      formatCurrency('total_amount', digits = 0) %>% 
      formatStyle("total_amount", color = "darkgreen") %>% 
      formatStyle('contributor_name', fontWeight = 'bold') 
      # formatStyle("salary", color = "darkred") %>% 
    #   formatStyle(
    #   'inaug_2017_total',
    #   background = styleColorBar(contribs_table$inaug_2017_total, 'steelblue'),
    #   backgroundSize = '100% 90%',
    #   backgroundRepeat = 'no-repeat',
    #   backgroundPosition = 'center'
    # )


```

<!-- Row -->
<!-- ----------------------------------------------------------------------- -->

<!-- ### Box 1 -->

<!-- ```{r} -->
<!-- valueBox("15", icon = "fa-pencil") -->

<!-- ``` -->

<!-- ### Box 2 -->

<!-- ```{r} -->
<!-- valueBox("15", icon = "fa-pencil") -->

<!-- ``` -->

<!-- ### Box 3 -->

<!-- ```{r} -->
<!-- valueBox("15", icon = "fa-pencil") -->

<!-- ``` -->




Top Locations for Individual Donors
=====================================
These charts show the breakdown of where individual donors to Trump's inaugural committee hail from, according to the committee's federal election filing. 

Row 
-----------------------------------------------------------------------

### Top 20 states 

```{r}

inaug_ind_bystate <- contribs %>% 
  filter(individual_or_organization == "Individual") %>% 
  group_by(state) %>% 
  summarise(total = sum(inaug_2017_total)) %>% 
  arrange(desc(total)) %>% 
  head(20)

#reorder factors to order bars descending
inaug_ind_bystate <- inaug_ind_bystate %>% 
  mutate(
    state = as.factor(state),
    state = fct_reorder(state, total)
    )

d <- ggplot(data = inaug_ind_bystate, aes(x = state, y = total)) +
  geom_col(
    # color = "#848484",
    fill = "#957DAD") + 
  # coord_flip() + 
  theme_minimal() +
  coord_flip()

d2 <- d + labs(x ="", y = "") +
  theme(legend.title=element_blank()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = dollar)

dd <- ggplotly(d2) 

dd_nomenu <- dd %>% config(displayModeBar = FALSE)
dd_nomenu
  

```

### Top 20 cities

```{r}

inaug_ind_bycity <- contribs %>% 
  filter(individual_or_organization == "Individual") %>% 
  mutate(citystate = paste0(city,", ",state)) %>% 
  group_by(citystate) %>% 
  summarise(total = sum(inaug_2017_total)) %>% 
  arrange(desc(total)) %>% 
  head(20)

#reorder factors to order bars descending
inaug_ind_bycity <- inaug_ind_bycity %>% 
  mutate(
    citystate = as.factor(citystate),
    citystate = fct_reorder(citystate, total)
    )

d <- ggplot(data = inaug_ind_bycity, aes(x = citystate, y = total)) +
  geom_col(
    # color = "#848484",
    fill = "#ffb3ba") + 
  # coord_flip() + 
  theme_minimal() +
  coord_flip()

d2 <- d + labs(x ="", y = "") +
  theme(legend.title=element_blank()) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  scale_y_continuous(labels = dollar)

dd <- ggplotly(d2) 

dd_nomenu <- dd %>% config(displayModeBar = FALSE)
dd_nomenu
  

```





Other Contributions
=====================================
This table shows who donors to the Trump inauguration have also donated to in the past, according to data compiled by the [Center for Responsive Politics](https://docs.google.com/spreadsheets/d/1MgxCjiw0niZxuSlfUEqbHpiLhrSL97XYOisgTzYbmVc/edit?usp=sharing).

To filter, click on the boxes at the top of the columns. To sort, use the up/down arrows by the column names.

Row {data-height=1000}
-----------------------------------------------------------------------

```{r}

contribs_all <- contribs %>% 
  select(
    -inaug_2017_total,
    -ind_contrib_category
  ) %>% 
  mutate(
    individual_or_organization = as.factor(str_to_upper(individual_or_organization)),
    org_name = str_to_upper(org_name),
    parent_company = str_to_upper(parent_company)
  ) %>% 
  arrange(individual_or_organization, contributor_name)


datatable(contribs_all,
          rownames = FALSE,
          filter = "top",
          extensions = 'Buttons', 
          options = list(searchHighlight = TRUE, bPaginate = FALSE, dom = 'Bfrtip',
       buttons = c('copy', 'csv', 'excel', 'print')
          )) %>% 
      formatCurrency(c("trump_campaign_2016", "other_2016_presidential_campaigns",
                     "total_contribs_1989_to_2017", "repubs_conservatives_1989_to_2017",
                     "dems_liberals_1989_to_2017"), digits = 0) %>%
      # formatStyle("total_amount", color = "darkgreen") %>% 
      formatStyle('contributor_name', fontWeight = 'bold') 

names(contribs)

```

